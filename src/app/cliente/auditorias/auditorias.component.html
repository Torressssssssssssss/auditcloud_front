<div class="auditorias-container">
  
  <div class="header">
    <h2>Mis Auditorías</h2>
    <p class="subtitle">Historial de evaluaciones ambientales</p>
  </div>

  <div class="filters-bar">
    <div class="filter-item">
      <label>Estado:</label>
      <select (change)="onEstadoChange($event)">
        <option value="">Todos</option>
        <option value="1">Creada</option>
        <option value="2">En Proceso</option>
        <option value="3">Finalizada</option>
      </select>
    </div>
    
    <div class="filter-item">
      <label>Módulo:</label>
      <select (change)="onModuloChange($event)">
        <option value="">Todos</option>
        <option value="1">Agua</option>
        <option value="2">Residuos</option>
        <option value="3">Energía</option>
      </select>
    </div>
  </div>

  @if (loading()) {
    <app-loading-spinner />
  } @else if (auditoriasFiltradas().length === 0) {
    <app-empty-state mensaje="No se encontraron auditorías con estos filtros." />
  } @else {
    <div class="card-table">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Empresa Auditora</th>
            <th>Módulos</th>
            <th>Estado</th>
            <th>Fecha Creación</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (audit of auditoriasFiltradas(); track audit.id_auditoria) {
            <tr>
              <td class="font-bold">#{{ audit.id_auditoria }}</td>
              <td>
                <div class="empresa-info">
                  <span class="empresa-name">{{ audit.empresa?.nombre || 'N/A' }}</span>
                </div>
              </td>
              <td>
                <span class="modulos-text">{{ getModulosTexto(audit.modulos) }}</span>
              </td>
              <td>
                <app-status-badge [estado]="audit.id_estado" tipo="auditoria" />
              </td>
              <td class="text-muted">{{ audit.fecha_creacion | date:'mediumDate' }}</td>
                <td class="text-right">
                  <a [routerLink]="['/cliente/timeline']" [queryParams]="{ auditoria: audit.id_auditoria }" class="btn-action">
                    Ver Bitácora
                    <app-icon name="chevron-right" [size]="16"></app-icon>
                  </a>
                </td>
              </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
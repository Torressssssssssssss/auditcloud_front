<div class="detalle-page">
  @if (loading()) {
    <app-loading-spinner />
  } @else if (!solicitud()) {
    <app-empty-state mensaje="Solicitud de pago no encontrada" />
  } @else {
    <div class="page-header">
      <button class="btn btn-secondary" (click)="router.navigate(['/cliente/pagos'])">
        ← Volver
      </button>
      <h2>Solicitud de Pago #{{ solicitud()!.id_solicitud }}</h2>
    </div>

    <div class="detalle-grid">
      <div class="info-card">
        <h3>Información</h3>
        <div class="info-item">
            <label>Concepto:</label> <span>{{ solicitud()!.concepto }}</span>
        </div>
        <div class="info-item">
            <label>Monto:</label> <span class="monto">{{ formatearMonto(solicitud()!.monto) }}</span>
        </div>
      </div>

      @if (solicitud()!.id_estado === 1) {
        <div class="info-card full-width">
          <h3>Procesar Pago</h3>
          <p>Para activar su auditoría, favor de cubrir el monto de: <strong>{{ formatearMonto(solicitud()!.monto) }}</strong></p>
          
          <app-pago-paypal 
            [solicitud]="solicitud()" 
            (pagoExitoso)="onPagoCompletado($event)">
          </app-pago-paypal>
        </div>
      } 
      
      @else if (solicitud()!.id_estado === 2) {
        <div class="info-card full-width">
          <div class="alert alert-success">
            <strong>
              <app-icon name="check-circle" [size]="18"></app-icon>
              Pago Completado
            </strong>
            <p>Pago procesado el {{ solicitud()!.pagada_en | date:'short' }}.</p>
            
            <div class="mt-4">
              <p>Se ha generado una nueva auditoría automáticamente.</p>
              <a [routerLink]="['/cliente/auditorias']" class="btn btn-primary">
                 Ver Mis Auditorías
              </a>
            </div>
          </div>
        </div>
      }

    </div>
  }
</div>
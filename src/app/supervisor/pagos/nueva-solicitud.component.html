<div class="nueva-solicitud-wrapper">
  <div class="form-header">
    <h3>Nueva Solicitud de Pago</h3>
    <p class="form-subtitle">Selecciona la empresa y el monto a cobrar</p>
  </div>

  <div *ngIf="errorMsg" class="error-banner">
    {{ errorMsg }}
  </div>

  <form (ngSubmit)="crear()" class="solicitud-form">
    
    <div class="form-group">
      <label for="id_empresa">Empresa (Cliente) *</label>
      <select 
        id="id_empresa"
        [(ngModel)]="id_empresa" 
        (change)="onEmpresaChange()"
        name="id_empresa"
        class="form-input select-arrow"
        [disabled]="loadingData">
        
        <option [ngValue]="null" disabled selected>-- Selecciona una empresa --</option>
        <option *ngFor="let emp of listaEmpresas" [value]="emp.id_empresa">
          {{ emp.nombre }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="id_cliente">Usuario Destino (Opcional)</label>
      <select 
        id="id_cliente"
        [(ngModel)]="id_cliente" 
        name="id_cliente"
        class="form-input select-arrow"
        [disabled]="!id_empresa || listaUsuarios.length === 0">
        
        <option [ngValue]="null" selected>
          {{ listaUsuarios.length === 0 ? '-- Selecciona empresa primero --' : '-- Enviar al administrador principal --' }}
        </option>
        <option *ngFor="let user of listaUsuarios" [value]="user.id_usuario">
          {{ user.nombre }} ({{ user.correo }})
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="monto">Monto (MXN) *</label>
      <input 
        type="number" 
        id="monto"
        [(ngModel)]="monto" 
        name="monto"
        placeholder="Ej: 1500.00"
        step="0.01"
        class="form-input"
      />
    </div>

    <div class="form-group">
      <label for="concepto">Concepto *</label>
      <textarea 
        id="concepto"
        [(ngModel)]="concepto" 
        name="concepto"
        placeholder="Describe el concepto del pago"
        class="form-input"
        rows="3"
      ></textarea>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="loading || !id_empresa" class="btn-submit">
        <span *ngIf="!loading">✓ Crear y Notificar</span>
        <span *ngIf="loading">Procesando...</span>
      </button>
      <button type="button" (click)="reset()" [disabled]="loading" class="btn-reset">
        ↻ Limpiar
      </button>
    </div>
  </form>
</div>
<div class="pagos-container">
  <div class="header">
    <h2 class="title">Gestión de Cobranza</h2>
    <div class="header-actions">
      <button (click)="mostrarFormulario.set(!mostrarFormulario())" class="btn-new">
        <span *ngIf="!mostrarFormulario()">+ Nueva Solicitud de Pago</span>
        <span *ngIf="mostrarFormulario()">✕ Cerrar Formulario</span>
      </button>
      <button (click)="load()" class="btn-refresh">↻ Refrescar</button>
    </div>
  </div>

  <div *ngIf="mostrarFormulario()" class="form-wrap">
    <app-supervisor-nueva-solicitud (solicitudCreada)="onSolicitudCreada()"></app-supervisor-nueva-solicitud>
  </div>

  <div class="table-section">
    <h3 class="section-title">Pagos Realizados</h3>
    <div class="table-card">
      <div *ngIf="loading()" class="loading-container">Cargando solicitudes...</div>
      <div *ngIf="!loading() && pagos.length === 0" class="empty-container">No hay solicitudes registradas.</div>
      <div *ngIf="!loading() && pagos.length > 0" class="table-responsive">
        <table class="pagos-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Empresa / Cliente</th>
              <th>Concepto</th>
              <th>Monto</th>
              <th>Estado</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of pagos" [ngClass]="{'row-pending': p.id_estado === 1, 'row-paid': p.id_estado !== 1}">
              <td class="cell-id">{{ p.id_solicitud }}</td>
              <td>{{ p.nombre_empresa_cliente || ('ID: ' + (p.id_empresa || p.id_empresa_cliente || p.id_cliente)) }}</td>
              <td>{{ p.concepto }}</td>
              <td class="cell-amount">{{ p.monto | currency:'MXN':'symbol':'1.2-2' }}</td>
              <td class="cell-status">
                <span [ngClass]="p.id_estado === 1 ? 'badge-pending' : 'badge-paid'">
                  {{ p.id_estado === 1 ? 'PENDIENTE' : 'PAGADA' }}
                </span>
              </td>
              <td class="cell-date">{{ p.creado_en | date:'short' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

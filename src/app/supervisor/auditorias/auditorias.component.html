<div class="auditorias-page">
  <div class="page-header">
    <h2>Auditorías</h2>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label>Filtrar por estado:</label>
      <select [value]="filtroEstado() ?? ''" (change)="onEstadoChange($event)">
        <option value="">Todos</option>
        <option [value]="1">CREADA</option>
        <option [value]="2">EN_PROCESO</option>
        <option [value]="3">FINALIZADA</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Buscar cliente:</label>
      <input type="text" placeholder="Nombre del cliente..." [value]="filtroCliente()" (input)="onClienteChange($event)" />
    </div>
  </div>

  @if (loading()) {
    <app-loading-spinner />
  } @else if (auditoriasFiltradas.length === 0) {
    <app-empty-state mensaje="No hay auditorías" />
  } @else {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Estado</th>
            <th>Módulos</th>
            <th>Fecha Creación</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (auditoria of auditoriasFiltradas; track auditoria.id_auditoria) {
            <tr>
              <td>#{{ auditoria.id_auditoria }}</td>
              <td>{{ auditoria.cliente?.nombre_empresa || auditoria.cliente?.nombre || 'N/A' }}</td>
              <td>
                <app-status-badge [estado]="auditoria.id_estado" tipo="auditoria" />
              </td>
              <td>{{ getModulosTexto(auditoria.modulos) }}</td>
              <td>{{ auditoria.fecha_creacion ? (auditoria.fecha_creacion | date:'short') : '-' }}</td>
              <td>
                <a [routerLink]="['/supervisor/auditorias', auditoria.id_auditoria]" class="btn-link">
                  Ver detalle
                </a>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>


